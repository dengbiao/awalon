# Task 1.4.4 设计并实现结果分享功能

## 任务描述

设计并实现阿瓦隆游戏结束后的结果分享功能，使玩家能够将游戏结果、角色信息和数据统计分享给好友或群聊。结果分享功能能够增强游戏的社交性，提高游戏的传播效果，并为玩家提供炫耀战绩和邀请好友的途径。

## 功能需求

1. **分享卡片设计**

   - 设计美观、信息丰富的分享卡片
   - 在卡片中展示游戏结果、胜利阵营和关键数据
   - 根据不同的分享场景（结果、角色、统计）设计不同的卡片样式

2. **分享内容定制**

   - 允许玩家选择要分享的内容类型（结果、角色信息、数据统计）
   - 提供简单的编辑功能，允许玩家添加个性化文字
   - 确保分享内容不会泄露敏感游戏信息（如未开始的新游戏）

3. **分享渠道**

   - 支持分享到微信好友
   - 支持分享到微信群聊
   - 支持生成分享图片保存到本地

4. **邀请功能**
   - 在分享卡片中加入游戏邀请链接或二维码
   - 接收方可通过分享内容直接加入新游戏
   - 跟踪分享邀请的转化率

## 界面需求

1. **分享按钮设计**

   - 在游戏结束界面的各个部分（结果、角色、统计）添加明显的分享按钮
   - 设计符合微信风格的分享图标和提示
   - 确保分享按钮位置醒目但不干扰主要内容

2. **分享面板设计**

   - 设计简洁的分享选项面板
   - 清晰展示不同的分享内容选项
   - 提供预览功能，让玩家在分享前查看效果

3. **分享卡片布局**

   - 设计符合微信分享规范的卡片尺寸和布局
   - 确保关键信息在卡片中清晰可见
   - 加入游戏标识和品牌元素，提高识别度

4. **反馈设计**
   - 为分享操作提供明确的成功/失败反馈
   - 设计分享完成后的引导提示
   - 考虑分享权限被拒绝的情况，提供合适的提示

## 技术需求

1. **微信分享 API**

   - 集成微信小游戏的分享 API
   - 处理不同分享场景的参数和回调
   - 确保分享功能在各种微信版本中稳定工作

2. **图片生成**

   - 实现动态生成分享图片的功能
   - 优化图片生成性能和质量
   - 确保生成的图片符合微信分享规范

3. **数据处理**

   - 从游戏状态中提取适合分享的数据
   - 确保分享数据的准确性和一致性
   - 实现数据的简化和格式化，适合在分享卡片中展示

4. **安全考虑**
   - 确保分享功能不会泄露敏感游戏数据
   - 实现适当的数据脱敏和隐私保护
   - 防止分享功能被滥用

## 实现步骤

1. **设计阶段**

   - 设计分享卡片的视觉样式和布局
   - 确定不同分享场景的内容模板
   - 设计分享流程和用户交互

2. **开发阶段**

   - 集成微信小游戏分享 API
   - 实现动态生成分享图片的功能
   - 开发分享内容的数据处理逻辑
   - 实现分享面板和交互功能

3. **测试阶段**

   - 测试不同设备和微信版本下的分享功能
   - 验证分享卡片在不同场景下的显示效果
   - 确保分享流程流畅，无卡顿或错误

4. **优化阶段**
   - 优化分享图片的生成性能
   - 调整分享内容的展示效果
   - 完善分享功能的用户体验

## 界面原型

```
+----------------------------------+
|        分享游戏结果               |
+----------------------------------+
|                                  |
|      选择要分享的内容：           |
|                                  |
|  [✓] 游戏结果和胜利阵营           |
|  [ ] 所有玩家的角色信息           |
|  [ ] 游戏数据统计                 |
|                                  |
|      添加个性化文字：             |
|  +------------------------------+ |
|  | 刚刚玩了一局阿瓦隆，好人阵营... | |
|  +------------------------------+ |
|                                  |
|      预览：                       |
|  +------------------------------+ |
|  |                              | |
|  |     [分享卡片预览区域]        | |
|  |                              | |
|  +------------------------------+ |
|                                  |
|  [分享给好友]  [分享到群聊]       |
|  [保存图片]    [取消]             |
|                                  |
+----------------------------------+
```

## 数据结构

```typescript
// 分享内容配置接口
interface ShareConfig {
  contentType: ShareContentType[]; // 要分享的内容类型
  customMessage?: string; // 自定义文字
  includeInvitation: boolean; // 是否包含邀请链接
  targetScene?: ShareScene; // 目标分享场景
}

// 分享内容类型枚举
enum ShareContentType {
  GAME_RESULT = "游戏结果",
  PLAYER_ROLES = "角色信息",
  GAME_STATS = "数据统计",
}

// 分享场景枚举
enum ShareScene {
  FRIEND = "好友",
  GROUP = "群聊",
  TIMELINE = "朋友圈",
  SAVE_IMAGE = "保存图片",
}

// 分享结果接口
interface ShareResult {
  success: boolean; // 分享是否成功
  scene?: ShareScene; // 实际分享场景
  errorMsg?: string; // 错误信息（如果有）
  timestamp: number; // 分享时间戳
}

// 分享卡片数据接口
interface ShareCardData {
  gameResult: {
    // 游戏结果数据
    winningTeam: "good" | "evil"; // 获胜阵营
    winReason: string; // 胜利原因
    missionResults: boolean[]; // 任务结果
  };
  playerRoles?: {
    // 角色信息（可选）
    playerName: string; // 玩家名称
    role: string; // 角色
    alignment: "good" | "evil"; // 阵营
  }[];
  gameStats?: {
    // 游戏统计（可选）
    totalMissions: number; // 总任务数
    totalVotings: number; // 总投票数
    gameTime: number; // 游戏时间
    keyStats: string[]; // 关键统计点
  };
  invitationCode?: string; // 邀请码（可选）
}
```

## 验收标准

1. **功能验收**

   - 能够成功分享到微信好友和群聊
   - 分享卡片内容正确，包含选定的游戏信息
   - 分享图片生成质量良好，文字清晰可读
   - 邀请功能正常工作，接收方可通过分享内容加入游戏

2. **界面验收**

   - 分享按钮位置醒目，易于发现
   - 分享面板设计符合微信风格
   - 分享卡片设计美观，信息展示合理
   - 分享操作有明确的反馈和提示

3. **技术验收**
   - 分享功能在不同设备和微信版本中稳定工作
   - 图片生成性能良好，不影响游戏体验
   - 分享数据处理准确，无错误
   - 分享功能不会泄露敏感游戏数据

## 技术依赖

1. 微信小游戏分享 API
2. Canvas 或 OffscreenCanvas - 用于生成分享图片
3. 游戏状态管理模块 - 提供游戏结果和角色数据
4. 图片处理库 - 用于优化分享图片

## 工作量估计

- 设计工作：1 人日
- 开发工作：2 人日
- 测试和优化：1 人日
- 总计：4 人日

## 相关文档

- [微信小游戏分享 API 文档](https://developers.weixin.qq.com/minigame/dev/api/share/wx.shareAppMessage.html)
- [阿瓦隆游戏规则](../../../阿瓦隆游戏规则.md)
- [Story1.4 游戏结束界面 README](../README.md)
- [Story1.4 技术方案](../技术方案.md)
- [Task1.4.1 设计并实现游戏结果展示](./Task1.4.1_设计并实现游戏结果展示.md)
- [Task1.4.2 设计并实现角色揭示界面](./Task1.4.2_设计并实现角色揭示界面.md)
- [Task1.4.3 设计并实现游戏数据统计界面](./Task1.4.3_设计并实现游戏数据统计界面.md)
- [Task1.4.5 设计并实现后续操作界面](./Task1.4.5_设计并实现后续操作界面.md)
