# Task 1.4.3 设计并实现游戏数据统计界面

## 任务描述

设计并实现阿瓦隆游戏结束后的数据统计界面，该界面将展示游戏过程中的关键数据和统计信息，帮助玩家分析游戏过程，了解每位玩家的表现和关键决策点。数据统计界面能够增强游戏的复盘价值，提供更深入的游戏体验。

## 功能需求

1. **任务统计**

   - 显示每轮任务的成功/失败结果
   - 展示每轮任务的队伍组成
   - 统计每轮任务中的成功/失败票数

2. **投票统计**

   - 展示每次组队投票的赞成/反对情况
   - 统计每位玩家的投票模式（赞成率、反对率）
   - 可视化关键投票轮次的结果

3. **玩家表现**

   - 统计每位玩家被选入任务队伍的次数
   - 展示每位玩家担任队长的次数
   - 对比不同玩家的投票一致性

4. **关键事件**
   - 标记游戏中的转折点（如连续拒绝的组队）
   - 突出显示决定性的任务或投票
   - 展示刺客猜测环节（如果发生）

## 界面需求

1. **视觉设计**

   - 使用清晰的图表和数据可视化组件
   - 采用符合游戏风格的色彩和图标
   - 确保数据展示直观易懂

2. **布局设计**

   - 采用分页或标签式布局，将不同类型的统计分类展示
   - 在有限空间内合理安排复杂的数据展示
   - 确保重要数据优先展示，次要数据可通过交互查看
   - 适配不同尺寸的手机屏幕

3. **交互设计**
   - 支持点击/滑动查看详细数据
   - 提供数据筛选和排序功能
   - 设计直观的图表交互方式
   - 确保所有交互元素尺寸合适，易于触控

## 技术需求

1. **数据可视化**

   - 使用适合微信小游戏的图表库（如 ECharts Mini）
   - 实现柱状图、饼图、折线图等多种图表类型
   - 确保图表渲染性能良好

2. **数据处理**

   - 从游戏历史记录中提取并处理统计数据
   - 实现数据聚合和分析算法
   - 确保数据计算准确性

3. **响应式设计**

   - 适配不同尺寸和分辨率的手机屏幕
   - 确保图表在不同设备上都能正确显示
   - 优化小屏幕设备上的数据展示方式

4. **性能优化**
   - 优化大量数据的渲染性能
   - 实现数据的懒加载或分批加载
   - 减少不必要的重绘和计算

## 实现步骤

1. **设计阶段**

   - 设计各类数据的可视化方案
   - 确定界面布局和交互方式
   - 设计数据筛选和展示的逻辑

2. **开发阶段**

   - 实现数据处理和分析模块
   - 开发各类图表组件
   - 实现界面布局和交互功能
   - 集成数据源和可视化组件

3. **测试阶段**

   - 测试不同游戏数据下的统计展示
   - 验证在不同设备上的显示效果
   - 确保数据计算准确性和图表渲染性能

4. **优化阶段**
   - 优化图表渲染性能
   - 调整数据展示的直观性
   - 完善交互细节和用户体验

## 界面原型

```
+----------------------------------+
|        游戏数据统计               |
+----------------------------------+
| [任务统计] [投票统计] [玩家表现]   |
+----------------------------------+
|                                  |
|         [任务成功率图表]          |
|                                  |
|  任务1: 成功 (3赞成/0反对)        |
|  任务2: 失败 (1赞成/2反对)        |
|  任务3: 成功 (3赞成/0反对)        |
|  任务4: 成功 (4赞成/0反对)        |
|  任务5: 未执行                    |
|                                  |
|         [组队投票统计]            |
|                                  |
|  总投票次数: 12                   |
|  通过率: 33%                     |
|  连续拒绝最多: 3次 (第3轮任务)     |
|                                  |
|  [按玩家筛选]  [按轮次筛选]        |
|                                  |
|  [返回角色]    [分享统计]          |
|                                  |
+----------------------------------+
```

## 数据结构

```typescript
// 游戏统计数据接口
interface GameStatistics {
  missionStats: MissionStat[]; // 任务统计
  votingStats: VotingRoundStat[]; // 投票统计
  playerStats: PlayerStat[]; // 玩家统计
  keyEvents: KeyEvent[]; // 关键事件
  gameTime: number; // 游戏持续时间（秒）
}

// 任务统计接口
interface MissionStat {
  missionNumber: number; // 任务轮次
  result: "success" | "fail"; // 任务结果
  teamMembers: string[]; // 队伍成员ID
  successVotes: number; // 成功票数
  failVotes: number; // 失败票数
  leader: string; // 队长ID
  attemptNumber: number; // 尝试次数（第几次组队成功）
}

// 投票轮次统计接口
interface VotingRoundStat {
  missionNumber: number; // 任务轮次
  attemptNumber: number; // 尝试次数
  approveVotes: string[]; // 赞成的玩家ID
  rejectVotes: string[]; // 反对的玩家ID
  proposedTeam: string[]; // 提议的队伍成员ID
  leader: string; // 队长ID
  result: "approved" | "rejected"; // 投票结果
}

// 玩家统计接口
interface PlayerStat {
  playerId: string; // 玩家ID
  playerName: string; // 玩家名称
  role: string; // 角色
  alignment: "good" | "evil"; // 阵营
  timesAsLeader: number; // 担任队长次数
  timesInTeam: number; // 被选入队伍次数
  approveVoteCount: number; // 赞成票数
  rejectVoteCount: number; // 反对票数
  successMissions: number; // 参与成功的任务数
  failMissions: number; // 参与失败的任务数
}

// 关键事件接口
interface KeyEvent {
  eventType: KeyEventType; // 事件类型
  missionNumber?: number; // 相关任务轮次
  attemptNumber?: number; // 相关尝试次数
  playersInvolved: string[]; // 相关玩家ID
  description: string; // 事件描述
}

// 关键事件类型枚举
enum KeyEventType {
  CONSECUTIVE_REJECTIONS = "连续拒绝",
  DECISIVE_MISSION = "决定性任务",
  UNANIMOUS_VOTE = "一致投票",
  ASSASSINATION = "刺客猜测",
}
```

## 验收标准

1. **功能验收**

   - 正确显示所有任务的统计数据
   - 准确展示投票统计和玩家表现
   - 关键事件标记清晰且准确
   - 数据筛选和排序功能正常工作

2. **界面验收**

   - 图表和数据可视化组件清晰直观
   - 界面布局合理，重要信息突出
   - 交互操作流畅，反馈明确
   - 在不同尺寸的手机屏幕上显示正常

3. **技术验收**
   - 图表渲染流畅，不出现卡顿
   - 数据计算准确，无错误
   - 在低端设备上也能保持良好性能
   - 响应式设计正常工作

## 技术依赖

1. ECharts Mini 或其他适合微信小游戏的图表库
2. PIXI.js - 用于 2D 渲染
3. 游戏历史记录模块 - 提供游戏过程数据
4. 数据处理工具库 - 用于数据聚合和分析

## 工作量估计

- 设计工作：1 人日
- 开发工作：3 人日
- 测试和优化：1 人日
- 总计：5 人日

## 相关文档

- [阿瓦隆游戏规则](../../../阿瓦隆游戏规则.md)
- [Story1.4 游戏结束界面 README](../README.md)
- [Story1.4 技术方案](../技术方案.md)
- [Task1.4.1 设计并实现游戏结果展示](./Task1.4.1_设计并实现游戏结果展示.md)
- [Task1.4.2 设计并实现角色揭示界面](./Task1.4.2_设计并实现角色揭示界面.md)
- [Task1.4.4 设计并实现结果分享功能](./Task1.4.4_设计并实现结果分享功能.md)
